<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
<style>
body {
    color: #333;
    font-size: 25pt;
    background-color: blue;
}

h1 {
    font-size: 150pt;
    color: red;
}</style>
<script>

//important
window.token = '{{ token }}';
// Perform background initialization
doAjax("/init", "POST");


//bellow is the ajax handler
// From https://gist.github.com/dharmavir/936328
function getHttpRequestObject() {
    // Define and initialize as false
    var xmlHttpRequst = false;

    // Mozilla/Safari/Non-IE
    if (window.XMLHttpRequest) {
        xmlHttpRequst = new XMLHttpRequest();
    }
    // IE
    else if (window.ActiveXObject) {
        xmlHttpRequst = new ActiveXObject("Microsoft.XMLHTTP");
    }
    return xmlHttpRequst;
}

// Does the AJAX call to URL specific with rest of the parameters
function doAjax(url, method, responseHandler, data) {
    // Set the variables
    url = url || "";
    method = method || "GET";
    async = true;
    data = data || {};
    data.token = window.token;

    if (url == "") {
        alert("URL can not be null/blank");
        return false;
    }
    var xmlHttpRequest = getHttpRequestObject();

    // If AJAX supported
    if (xmlHttpRequest != false) {
        xmlHttpRequest.open(method, url, async);
        // Set request header (optional if GET method is used)
        if (method == "POST") {
            xmlHttpRequest.setRequestHeader("Content-Type", "application/json");
        }
        // Assign (or define) response-handler/callback when ReadyState is changed.
        xmlHttpRequest.onreadystatechange = responseHandler;
        // Send data
        xmlHttpRequest.send(JSON.stringify(data));
    }
    else {
        alert("Please use browser with Ajax support.!");
    }
}


function getMethods(obj) {
    var result = [];
    for (var id in obj) {
      try {
        if (typeof(obj[id]) == "function") {
          result.push(id + ": " + obj[id].toString());
        }
      } catch (err) {
        result.push(id + ": inaccessible");
      }
    }
    return result;
}</script>
<script>
function openFolderHandler() {
    if (this.responseText) {
        var response = JSON.parse(this.responseText);
        document.getElementById("open-folder-container").innerHTML = 'Selected directory: ' + response.directory;
    }
}

function openFolder() {
    doAjax("/choose/path", "POST", openFolderHandler);
}

function submit() {
    //first get values and concatinate them
   
    var strs = new Array(3)
    var data_string = "";

    for (let index = 1; index <= strs.length; index++) {
        var ind = "v".concat(index.toString()); 
        if (index != strs.length) {
            var toAppend = document.getElementById(ind).value.concat("~");
            data_string = data_string.concat(toAppend);
        } else{
            data_string = data_string.concat(document.getElementById(ind).value);
        }
        
        
    }
    var toSend = "/values/".concat(data_string);
    doAjax(toSend, "POST", doStuffHandler);
}</script>
<script>
function doStuffHandler(response) {
    if (this.responseText) {
        var response = JSON.parse(this.responseText);
        document.getElementById("stuff-container").innerHTML = response.result;
    }

}

function toggleFullscreen() {
    doAjax("/fullscreen", "POST", doStuffHandler);
}</script>
    </head>
<body>

<h1>values</h1>

<label for="fname">Value 1:</label>
<input type="text" id="v1" name="v1"><br><br>
<label for="fname">Value 2:</label>
<input type="text" id="v2" name="v2"><br><br>
<label for="fname">Value 3:</label>
<input type="text" id="v3" name="v3"><br><br>

<button onclick="openFolder()">Select save File</button>
<button onclick="toggleFullscreen()">Toggle fullscreen</button>
<button onclick="submit()">Send Values</button>
<div id="open-folder-container"></div>
<div id="stuff-container"></div>
<div id="json-container"></div>

<a href="monitor"> to the monitor page!</a>

</body>
</html>
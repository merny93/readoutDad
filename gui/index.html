<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <style type="text/css">
        body {
            color: #333;
            font-size: 14pt;
        }
        h1 {
            font-size: 24pt;
            color: red;
        }

    </style>
</head>
<body>

<p> Welcome to the dad code</p>
<button onclick="checkConnection()">Click to reconnect the serial interfaces</button>
<div id="connectionStatus"> </div>
<button onclick="toggleFullscreen()">Toggle fullscreen</button>
<div id="stuff-container"></div>
<a href="setup"> Take me to setup</a>

<script>
    //important
    window.token = '{{ token }}';
    // Perform background initialization
    doAjax("/init", "POST");



    function serialHandler(response) {
        if (this.responseText) {
            var response = JSON.parse(this.responseText);
            document.getElementById("connectionStatus").innerHTML = response.result;
        }

    }

    function doStuffHandler(response) {
        if (this.responseText) {
            var response = JSON.parse(this.responseText);
            document.getElementById("stuff-container").innerHTML = response.result;
        }

    }

    function checkConnection() {
        doAjax("/connection", "POST", serialHandler);
    }

    function toggleFullscreen() {
        doAjax("/fullscreen", "POST", doStuffHandler);
    }









    //bellow is the ajax handler
    // From https://gist.github.com/dharmavir/936328
    function getHttpRequestObject()
    {
        // Define and initialize as false
        var xmlHttpRequst = false;

        // Mozilla/Safari/Non-IE
        if (window.XMLHttpRequest)
        {
            xmlHttpRequst = new XMLHttpRequest();
        }
        // IE
        else if (window.ActiveXObject)
        {
            xmlHttpRequst = new ActiveXObject("Microsoft.XMLHTTP");
        }
        return xmlHttpRequst;
    }

    // Does the AJAX call to URL specific with rest of the parameters
    function doAjax(url, method, responseHandler, data)
    {
        // Set the variables
        url = url || "";
        method = method || "GET";
        async = true;
        data = data || {};
        data.token = window.token;

        if(url == "") {
            alert("URL can not be null/blank");
            return false;
        }
        var xmlHttpRequest = getHttpRequestObject();

        // If AJAX supported
        if(xmlHttpRequest != false) {
            xmlHttpRequest.open(method, url, async);
            // Set request header (optional if GET method is used)
            if(method == "POST")  {
                xmlHttpRequest.setRequestHeader("Content-Type", "application/json");
            }
            // Assign (or define) response-handler/callback when ReadyState is changed.
            xmlHttpRequest.onreadystatechange = responseHandler;
            // Send data
            xmlHttpRequest.send(JSON.stringify(data));
        }
        else
        {
            alert("Please use browser with Ajax support.!");
        }
    }
</script>
</body>
</html>